포스트맨 cors 에러가 안나는 이유
서버에서 서버로 보내는 요청의 경우 cors 모듈이 담당하지 않기 때문이라고 한다.
cors는 프론트 서버도 아니고, 브라우저가 서버로 요청을 보내는 것을 브라우저 검사하는 것이기에 서버에서 서버로 요청을 보내는 것을 검사하려면 req.ip나 req.get 등을 사용해 검사해야 한다고 한다.
이러한 것들을 위조가 가능하기에 토큰등을 발급하는 식으로 서버에서 검사를 한다고 한다.

그라파나는 cors 설정이 불가능하다고 한다.
그라파나에 접근할 방법은 서버를 제외하고는 몇개 없을 것으로 보인다.
cors 없이 다른 도메인에 접근 가능한 방법은 현재 확인하바로 아래와 같다.
<script>
<link>
<iframe>
<video>
<audio>
<img>

클라이언트 상에서 세션가지고 iframe 로그인 처리를 해주는 부분까지는 구현할 수 있었다.
const session = '5db283c809c4e82aa0409c924f256491'
document.cookie = `grafana_session=${session}; path=/`

두줄이면 충분했다.
이제는 프로젝트 서버단에서 그라파나를 호출하여 세션을 받아 클라이언트에 넘겨줄수 있는 로직을 구축, 그라파나 페이지를 빠져나갈시 세션을 로그아웃처리를 하면 보안 문제는 어느정도 해결할 수 있을것으로 보인다.
서버가 클라이언트로서 다른서버의 api를 호출하기 위해서는 RestTemplate을 사용한다고 한다.
스프링 3.0 부터 지원하는 기능이기에 다행히 프로젝트 상에서는 처리를 할 수 있을 것으로 보인다.

서버단 restTemplate를 이용하여 session을 받아오는데 성공할수 있었다.
이때 사용하는 메소드로는 postForEntity 가 있으면 해당 메소드로 그라파나 서버를 호출시 무사히 헤더값과 메세지를 받아올수 있다.
문제는 이것을 클라이언트로 넘겨 줄 경우 Cookies의 값이 저장되지 않는다는 점이다.
하드코딩이 됐지만 리스트에서 Cookies 객체를 찾아 value 값을 뽑아 내주었다.
HttpOnly 속성역시 제거해 줌으로서 쿠키를 클라이언트에 적용할수 있게 되었다.
하지만 이런 세션 역시 탈취 위험이 있으므로 보안을 위해 세션 만료 시간을 매우 짧게 가져가고 jwt토큰 방식으로 전환하던지, 아니면 해당 세션의 권한을 제한할 필요가 있었다.
다행히 그라파나에는 아이디별 권한을 제한할수 있는 권한 설정이 존재했기에 아이디 권한 설정으로 접근권한을 어디까지나 view로만 두기로 했다.

