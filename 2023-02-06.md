그라파나의 세션을 server side에서 받아와 클라이언트로 전송 이후 쿠키에 저장하여 iframe으로 불러온 그라파나 대시보드를 자동으로 로그인하는 로직을 구현하여 이를 실 서버에 적용하려는 중 문제가 발생하였다.
cross-domain 에러가 발생한 것이다.
원인은 최근 크롬의 보안 정책 변경으로 third party domain에 쿠키를 저장할 수 없게 변경되었다.
Samesite 의 default 속성이 기존 None 속성에서 Lax로 변경되었기 때문이다.
이를 None 설정으로 바꾸기 위해서는 https로의 배포와 동시에 secure 속성으 쿠키에 추가할 필요가 있다.
문제는 그라파나에 해당 속성을 추가하는 경우 무한 로그인 현상이 발생하였다.
이후 그라파나 api key를 발급받는 방식도 시도해 보았지만 이역시 cors 문제로 인해 클라이언트에서는 받아올 수 없었다.
그라파나는 cors 속성을 넣을 수 없기 때문에 nginx 등을 이용해 프록시서버에서 cors 속성을 주입해 주어야 할것으로 보인다.
