MSSQL CONVERSION ISSUE
mssql을 사용하여 쿼리를 짜던 와중 쿼리 처리 시간이 기하급수적으로 증가하는 문제가 발생했다.

db의 용량은 300kb를 약간 넘는 정도 였으나 쿼리를 처리하는데 걸리는 시간은 20초를 초과한느 문제가 발생한 것.

처음에는 left outer join의 남발로 인한 문제로 보았으나 쿼리를 개선해 보아도 시간의 단축은 거의 되지 않았다.

결국 left outer join으로 합쳐지는 쿼리들을 개별적으로 실행해 보았고 원인을 찾을 수 있었다.

바로 select * where 날짜 > dbo.fn_getdate(0); 형식의 쿼리에서 대부분의 시간이 걸리게 된것이었다.

전혀 쿼리 시간을 잡아먹을게 없는 쿼리였기에 한참을 찾아보았고 원인을 찾을 수 있었다.

바로 mssql에서 간혈적으로 발생하는 conversion issue 문제였다.

로케일 상의 날짜와 db 칼럼 상의 날짜가 같은 국가가 아닌 다른 국가의 방식으로 인코딩 되어 있는 경우가 있는데 이경우 날짜를 fomatter 하여 사용할 경우 변환하는데 많은 시간을 소요하게 된다고 한다.

select * where 날짜 > convert(char(10), getdate(), 21) 이렇게 변환하면 해당 issue를 발생시키지 않고 빠르게 쿼리를 처리할 수 있다.
